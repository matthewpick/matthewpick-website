---
import BaseLayout from './BaseLayout.astro';
import GenerativeHero from '../components/GenerativeHero.astro';

interface Props {
  title: string;
  description: string;
  pubDate: Date;
  heroImage?: string;
  slug: string;
}

const { title, description, pubDate, heroImage, slug } = Astro.props;
const formattedDate = pubDate.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});
---

<BaseLayout title={title} description={description} image={heroImage}>
  <article class="py-12">
    <div class="max-w-3xl mx-auto px-4">
      <header class="mb-8">
        <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-terracotta/10 dark:bg-sage-light/10 text-terracotta dark:text-sage-light text-sm font-medium mb-4">
          {formattedDate}
        </div>
        <h1 class="text-3xl md:text-4xl font-bold text-charcoal dark:text-off-white mb-6">
          {title}
        </h1>
        <div class="aspect-video overflow-hidden rounded-xl border border-sand dark:border-forest/50">
          {heroImage ? (
            <img src={heroImage} alt="" class="w-full h-full object-cover" />
          ) : (
            <GenerativeHero slug={slug} />
          )}
        </div>
      </header>

      <div class="prose prose-lg max-w-none
        prose-headings:text-charcoal dark:prose-headings:text-off-white
        prose-p:text-charcoal/80 dark:prose-p:text-off-white/80
        prose-a:text-terracotta dark:prose-a:text-terracotta-light prose-a:no-underline hover:prose-a:underline
        prose-strong:text-charcoal dark:prose-strong:text-off-white
        prose-code:text-terracotta dark:prose-code:text-sage-light prose-code:bg-sand dark:prose-code:bg-forest prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded-md prose-code:before:content-none prose-code:after:content-none
        prose-pre:bg-deep-green dark:prose-pre:bg-forest prose-pre:rounded-xl prose-pre:border prose-pre:border-sand dark:prose-pre:border-forest/50
        prose-img:rounded-xl prose-img:border prose-img:border-sand dark:prose-img:border-forest/50
        prose-ul:text-charcoal/80 dark:prose-ul:text-off-white/80
        prose-ol:text-charcoal/80 dark:prose-ol:text-off-white/80
        prose-li:text-charcoal/80 dark:prose-li:text-off-white/80 prose-li:marker:text-terracotta dark:prose-li:marker:text-sage-light
        prose-blockquote:border-terracotta dark:prose-blockquote:border-sage-light prose-blockquote:text-charcoal/70 dark:prose-blockquote:text-off-white/70 prose-blockquote:bg-sand/30 dark:prose-blockquote:bg-forest/30 prose-blockquote:rounded-r-lg prose-blockquote:py-1
        prose-hr:border-sand dark:prose-hr:border-forest
      ">
        <slot />
      </div>

      <footer class="mt-12 pt-8 border-t border-sand dark:border-forest/50">
        <a href="/" class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-sand/50 dark:bg-forest/50 text-terracotta dark:text-terracotta-light hover:bg-sand dark:hover:bg-forest transition-colors">
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
          </svg>
          Back to all posts
        </a>
      </footer>
    </div>
  </article>
</BaseLayout>

<style is:global>
  .gist {
    margin: 1.5rem 0;
  }

  .gist .gist-file {
    border-radius: 0.75rem;
    overflow: hidden;
    border: 1px solid #253D30;
  }

  .dark .gist .gist-data {
    background-color: #1A2B22;
  }

  .dark .gist .gist-meta {
    background-color: #0F1A14;
    color: #F5F7F4;
    border-top: 1px solid #253D30;
  }

  .dark .gist .gist-meta a {
    color: #A3B896;
  }

  .dark .gist .blob-code,
  .dark .gist .blob-num {
    background-color: #1A2B22;
  }

  /* Remove zebra striping */
  .dark .gist tr:nth-child(odd) .blob-code,
  .dark .gist tr:nth-child(even) .blob-code,
  .dark .gist tr:nth-child(odd) .blob-num,
  .dark .gist tr:nth-child(even) .blob-num,
  .dark .gist .highlight tr:nth-child(odd),
  .dark .gist .highlight tr:nth-child(even) {
    background-color: #1A2B22 !important;
    border: none;
  }

  .dark .gist .blob-code {
    border-left: none !important;
  }

  /* Dark mode syntax highlighting overrides */
  .dark .gist .blob-num {
    color: #6B8F74;
    border-right: 1px solid #253D30;
  }

  .dark .gist .blob-code-inner {
    color: #F5F7F4;
  }

  .dark .gist .pl-c {
    color: #6B8F74;
  }

  .dark .gist .pl-k,
  .dark .gist .pl-s .pl-s1 {
    color: #D4896F;
  }

  .dark .gist .pl-en {
    color: #A3B896;
  }

  .dark .gist .pl-s,
  .dark .gist .pl-pds {
    color: #A3B896;
  }

  .dark .gist .pl-smi,
  .dark .gist .pl-s .pl-pse .pl-s1 {
    color: #F5F7F4;
  }

  .dark .gist .pl-ent {
    color: #6B8F74;
  }

  .dark .gist .pl-c1,
  .dark .gist .pl-v {
    color: #D4896F;
  }
</style>
